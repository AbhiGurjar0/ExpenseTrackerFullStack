<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinSet Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://sdk.cashfree.com/js/v3/cashfree.js"></script>
</head>

<body class="bg-gray-100 font-sans">

    <div class="flex">


        <div class="w-64 bg-purple-800 text-white min-h-screen px-4 py-6">
            <h1 class="text-lg font-bold mb-4">Expense Tracker</h1>
            <nav class="space-y-2">
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Dashboard</a>
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Transactions</a>
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Wallet</a>
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Goals</a>
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Budget</a>
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Analytics</a>
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Settings</a>
            </nav>
            <div class="mt-5">
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Help</a>
                <a href="#" class="block py-2 hover:bg-purple-600 rounded">Log out</a>
            </div>
        </div>


        <div class="flex-1 p-8">
            <div
                class="mb-6 bg-white shadow-md rounded-2xl p-6 flex flex-col md:flex-row items-center justify-between gap-6">
                <div
                    class="w-full  bg-gradient-to-r from-purple-50 to-purple-100 p-6 rounded-2xl shadow-sm flex justify-between">
                    <div>
                        <h2 class="text-3xl font-bold">
                            Welcome back,
                            <span class="text-purple-600 animate-pulse">
                                <%= user.userName %> ‚ú®
                            </span>
                        </h2>
                        <p class="text-gray-700 mt-1">
                            It‚Äôs the perfect time to manage your finances üöÄ
                        </p>
                    </div>

                    <% if (user.isPremium) { %>
                        <div class="flex gap-10">
                            <div
                                class="mt-4 flex items-center  bg-yellow-50 px-4 py-2 rounded-xl shadow-sm border border-yellow-200">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-400 animate-bounce"
                                    fill="currentColor" viewBox="0 0 24 24">
                                    <path
                                        d="M12 .587l3.668 7.435L24 9.423l-6 5.851L19.335 24 12 19.897 4.665 24 6 15.274 0 9.423l8.332-1.401z" />
                                </svg>
                                <span class="font-semibold text-yellow-600">Premium Member</span>
                            </div>

                            <a href="/leaderboard"
                                class=" mt-4 flex items-center px-4 py-2 shadow-sm border inline-block text-purple-600 font-medium bg-white px-4 text-center rounded-xl shadow hover:bg-purple-100 transition">
                                üèÜ See Leaderboard
                            </a>
                        </div>
                        <% } else { %>

                            <button id="renderBtn"
                                class="mt-4 inline-block text-white font-medium bg-gradient-to-r from-purple-500 to-purple-700 px-5 py-2 rounded-xl shadow hover:scale-105 transform transition">
                                üåü Upgrade to Premium
                            </button>
                            <% } %>
                </div>
            </div>




            <div class="flex items-center space-x-4 mb-6">
                <button class="bg-purple-500 text-white px-4 py-2 rounded">This month</button>
                <button class="bg-white text-purple-500 px-4 py-2 rounded border">Last month</button>
            </div>


            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="bg-white p-4 rounded shadow">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Total balance</span>

                    </div>
                    <h3 class="text-xl font-bold">
                        ‚Çπ<%=Balance%>
                    </h3>

                </div>

                <div class="bg-white p-4 rounded shadow flex justify-between items-center">
                    <div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Income</span>

                        </div>
                        <h3 class="text-xl font-bold">‚Çπ<%= totalIncome %>
                        </h3>
                    </div>
                    <button data-type="income" onclick="openInputBox(this)"
                        class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-full transition-colors duration-200">+</button>

                </div>

                <div class="bg-white p-4 rounded shadow flex justify-between items-center">
                    <div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Expense</span>

                        </div>
                        <h3 class="text-xl font-bold">‚Çπ<%= totalExpense %>
                        </h3>
                    </div>
                    <button data-type="expense" onclick="openInputBox(this)"
                        class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-full transition-colors duration-200">+</button>

                </div>


            </div>



            <div class="flex-1 flex flex-col p-6 bg-gray-50">

                <h1 class="text-2xl font-bold mb-6">Today</h1>


                <div class="mb-6">
                    <h2 class="text-lg font-semibold mb-2">Expenses</h2>
                    <div
                        class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 p-4 divide-y">
                        <% expense.forEach(item=> { %>
                            <div class="flex justify-between py-2">
                                <span>
                                    <%= item.title %>
                                </span>

                                <div class="flex space-x-2">
                                    <span class="text-red-500 font-semibold">- ‚Çπ<%= item.amount %></span>
                                    <div class="flex space-x-2">

                                        <button
                                            class="p-1.5 text-blue-500 hover:text-blue-700 rounded-full hover:bg-blue-50 transition-colors duration-150"
                                            onclick="editItem('<%= item.id %>')" aria-label="Edit item" title="Edit">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                            </svg>
                                        </button>


                                        <button
                                            class="p-1.5 text-red-500 hover:text-red-700 rounded-full hover:bg-red-50 transition-colors duration-150"
                                            onclick="deleteItem('<%= item.id %>')" aria-label="Delete item"
                                            title="Delete">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <% }) %>

                    </div>
                </div>

                <div class="mb-6">
                    <h2 class="text-lg font-semibold mb-2">Income</h2>
                    <div
                        class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 p-4 divide-y">
                        <% income.forEach(item=> { %>
                            <div
                                class="flex justify-between items-center py-3 px-4 bg-white rounded-lg shadow-sm hover:shadow transition-shadow duration-200">
                                <div class="flex-1 min-w-0">
                                    <span class="text-gray-800 font-medium truncate">
                                        <%= item.title %>
                                    </span>
                                </div>

                                <div class="flex items-center space-x-4 ml-4">
                                    <span class="text-green-600 font-semibold whitespace-nowrap">
                                        + ‚Çπ<%= item.amount %>
                                    </span>

                                    <div class="flex space-x-2">
                                        <button
                                            class="p-1.5 text-blue-500 hover:text-blue-700 rounded-full hover:bg-blue-50 transition-colors duration-150"
                                            onclick="editItem('<%= item.id %>')" aria-label="Edit item" title="Edit">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                            </svg>
                                        </button>
                                        <button class="p-1.5 text-red-500 hover:text-red-700 rounded-full hover:bg-red-50
                                transition-colors duration-150" onclick="deleteItem('<%= item.id %>')"
                                            aria-label="Delete item" title="Delete">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded p-4 shadow mb-6">
                <h3 class="text-lg font-bold mb-4">Recent transactions</h3>
                <table class="min-w-full border-collapse">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="border px-4 py-2">Date</th>
                            <th class="border px-4 py-2">Amount</th>
                            <th class="border px-4 py-2">Payment Name</th>
                            <th class="border px-4 py-2">Method</th>
                            <th class="border px-4 py-2">Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b">
                            <td class="border px-4 py-2">25 Jul 12:30</td>
                            <td class="border px-4 py-2">$10</td>
                            <td class="border px-4 py-2">YouTube</td>
                            <td class="border px-4 py-2">VISA **3254</td>
                            <td class="border px-4 py-2">Subscription</td>
                        </tr>
                        <tr class="border-b">
                            <td class="border px-4 py-2">26 Jul 15:00</td>
                            <td class="border px-4 py-2">$150</td>
                            <td class="border px-4 py-2">Reserved</td>
                            <td class="border px-4 py-2">Mastercard **2154</td>
                            <td class="border px-4 py-2">Shopping</td>
                        </tr>
                        <tr class="border-b">
                            <td class="border px-4 py-2">27 Jul 9:00</td>
                            <td class="border px-4 py-2">$80</td>
                            <td class="border px-4 py-2">Yaposhka</td>
                            <td class="border px-4 py-2">Mastercard **2154</td>
                            <td class="border px-4 py-2">Caf√© & Restaurants</td>
                        </tr>
                    </tbody>
                </table>
                <a href="#" class="text-purple-500 underline">See all</a>
            </div>

        </div>
    </div>

    <div id="inputBox" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-lg w-[300px]">
            <h2 class="text-lg font-semibold mb-4">Add Entry</h2>
            <form action="/add" method="post" class="space-y-3">
                <input type="hidden" id="val" name="val" value="">
                <input type="text" placeholder="Enter title" name="title" class="w-full border px-3 py-2 rounded"
                    required>
                <input type="number" placeholder="Enter amount" name="amount" class="w-full border px-3 py-2 rounded"
                    required>
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeInputBox()"
                        class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Cancel</button>
                    <button type="submit"
                        class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600">Add</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function openInputBox(button) {
            document.getElementById('inputBox').classList.remove('hidden');
            document.getElementById('val').value = button.getAttribute('data-type');
        }
        function closeInputBox() {
            document.getElementById('inputBox').classList.add('hidden');
        }
        async function deleteItem(id) {
            await fetch("/delete", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ id })
            })
        }
        const cashfree = Cashfree({
            mode: "sandbox",
        });
        document.getElementById("renderBtn").addEventListener("click", async () => {

            const response = await fetch("http://localhost:3000/pay", {
                method: "POST",
            });


            const data = await response.json();
            const paymentSessionId = data.paymentSessionId;
            let checkoutOptions = {
                paymentSessionId: paymentSessionId,
                redirectTarget: "_self",
            };
            await cashfree.checkout(checkoutOptions);
        });


    </script>
</body>

</html>